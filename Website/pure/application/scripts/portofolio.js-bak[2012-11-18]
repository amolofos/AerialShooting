/*	
	By Kafetzi Dimitri (www.kafetzisd.gr)
	This file contains custom scripts required by websites functionality

*/

/*
	Setting up the page
*/
var portfolio_trailers = [];
var tag = document.createElement('script');
tag.src = "//www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

$(document).ready(function(){
	
	$("nav#filter li").bind( "click",
					function( e ) {
						e.preventDefault();
						$(this).addClass("selected");
						$(this).siblings().removeClass("selected");
						$.each( $("#stage li"),
								function( ) {
									$('html, body').animate( {scrollTop:200 }, { duration: 10 ,specialEasing: {height: 'easeOutBounce'}});
									$(this).animate({
												position: 'absolute',
												top: 0,
												left: 0
												},
												500,
												function ( ) {
													for ( var i = 0; i < portfolio_trailers.length; i++ ) {
														portfolio_trailers[i].stopVideo();
													}
												}
											);
								
									if ( $(this).hasClass( $(e.currentTarget).attr("id") ) ) {
										$(this).css( "position", "relative" );
										$(this).css( "display", "block" );
										$(this).animate({
													opacity: 1
													},
													500,
													function ( ) {
													
													}
											);
									} else {
										$(this).css( "position", "absolute" );
										$(this).css( "display", "none" );
										$(this).animate({
													opacity: 0
													},
													300,
													function ( ) {
													
													}
											);
									}
								}
							);
							
					}
				);
				
/*
										<a class="addthis_button_facebook"></a>
										<a class="addthis_button_twitter"></a>
										<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
										<a class="addthis_button_tweet"></a>
										<a class="addthis_button_linkedin"></a>
										<a class="addthis_button_google_plusone_badge" g:plusone:href="https://plus.google.com/102383601500147943541/"></a>
										 <a class="addthis_button_pinterest_pinit" pi:pinit:url="http://www.apple.com" pi:pinit:media="http://images.apple.com/home/images/hero.jpg" pi:pinit:layout="horizontal">
										<a class="addthis_button_stumbleupon_badge"></a> 
										<a class="addthis_button_tumblr"></a>
										<a class="addthis_button_digg"></a>
										<a class="addthis_button_delicious"></a>
										<a class="addthis_button_compact"></a>
										<a class="addthis_counter addthis_bubble_style"></a>
*/

	
	setTopLevelNavBar();
	$("img.lazy").lazyload({
        event : "lazyload"
    });
});


function setTopLevelNavBar() {
	// Requried: Navigation bar drop-down
	$("nav ul li").hover(
		function() {
			$(this).addClass("active");
			$(this).find("ul").css("display", "block");
		},
		function() {
			$(this).removeClass("active");
			$(this).find("ul").css("display", "none");
		}
	);
	
	$("nav ul li").click(
		function(){
			$(this).siblings(".selected").find(".selected").removeClass("selected");	
			$(this).siblings(".selected").removeClass("selected");
			$(this).addClass("selected");
		}
	);
	$("nav ul li ul li").click(
		function(){
			$(this).siblings(".selected").removeClass("selected");
			$(this).parent().parent().siblings(".selected").find("ul li.selected").removeClass("selected");	
			$(this).parent().parent().siblings(".selected").removeClass("selected");
			
			$(this).addClass("selected");
			$(this).parent().parent().addClass("selected");
		}
	);
	
	// Requried: Additional styling elements
	$('nav ul li ul li:first-child').prepend('<li class="arrow"></li>');
	$('nav ul li:first-child').addClass('first');
	$('nav ul li:last-child').addClass('last');
	//$('nav ul li ul').parent().append('<span class="dropdown"></span>').addClass('drop');
				
}

function setCookie(c_name, value, exdays) {
	var exdate = new Date();
	exdate.setDate(exdate.getDate() + exdays);
	var c_value = escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;
}
function getCookie(c_name) {
	var i,x,y,ARRcookies=document.cookie.split(";");
	for (i=0;i<ARRcookies.length;i++) {
		x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
		y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
		x=x.replace(/^\s+|\s+$/g,"");
		if (x==c_name) {
			return unescape(y);
		}
	}
}

function validateEmailAddress( item ) {

    var pattern = new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);
    
	var email = $(item).val();
    
	if ( !pattern.test(email) ) {
        $(item).parent().addClass('error');
        return false;
    }
    return true;
}

function onYouTubeIframeAPIReady() {
	createportfolioTrailers();
}

function createportfolioTrailers ( ) {
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_1', {
		videoId: '_AeVgCd9U0E',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_2', {
		videoId: 'rT1BICpC1Gg',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_3', {
		videoId: 'AxmMFyiJ8uA',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_4', {
		videoId: 'AD5CfwNcHHM',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_5', {
		videoId: '-TIOiY6qpT8',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_6', {
		videoId: 'sCE-Ci_ZkKw',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_7', {
		videoId: 'jvBi8bLDCFk',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_8', {
		videoId: 'L86CoQdCNaA',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_9', {
		videoId: 'yMjJarOY-B8',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_10', {
		videoId: '6SB9jgI6qks',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	portfolio_trailers[portfolio_trailers.length] = new YT.Player('portfolio_video_11', {
		videoId: 'zkF5QFWbBuU',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	if ( $(window).width() >= 740 ) {
		for ( var i = 0; i < portfolio_trailers.length; i++ ) {
			setVideoDimensions( portfolio_trailers[i], "portfolio", 25 );
		}
	} else {
		for ( var i = 0; i < portfolio_trailers.length; i++ ) {
			setVideoDimensions( portfolio_trailers[i], "portfolio", 60 );
		}
	}
}

function onPlayerReady ( event ) {
	event.target.setPlaybackQuality("large");
}

function onportfolioPlayerStateChanged ( event ) {
	
	var wrapper = $(event.target.getIframe()).parent("figure");
	var wrapper_li = $(event.target.getIframe()).parent("figure").parent("li");
	var iframe = event.target.getIframe();
	
	if ( $(window).width() >= 740 ) {
		if ( event.data == YT.PlayerState.PLAYING ) {
			setVideoDimensions( event.target, "portfolio", 50 );
			$(wrapper_li).css("width", "auto");
			$(iframe).css("background-color", "rgba(252,180,31,0.3)");
			$(iframe).css("z-index", "400");
		} else if ( event.data == YT.PlayerState.ENDED ) {
			setVideoDimensions( event.target, "portfolio", 25 );
			$(wrapper_li).css("width", "auto");
			$(iframe).css("background-color", "rgba(200,200,200,0.3)");
			$(iframe).css("z-index", "0");
		} else if ( event.data == YT.PlayerState.PAUSED ) {
		
		} else if ( event.data == YT.PlayerState.BUFFERING ) {
		
		} 
	} else {
		if ( event.data == YT.PlayerState.PLAYING ) {
			setVideoDimensions( event.target, "portfolio", 75 );
			$(wrapper_li).css("width", "auto");
			$(iframe).css("background-color", "rgba(252,180,31,0.3)");
			$(iframe).css("z-index", "400");
		} else if ( event.data == YT.PlayerState.ENDED ) {
			setVideoDimensions( event.target, "portfolio", 60 );
			$(wrapper_li).css("width", "auto");
			$(iframe).css("background-color", "rgba(200,200,200,0.3)");
			$(iframe).css("z-index", "0");			
		} else if ( event.data == YT.PlayerState.PAUSED ) {
		
		} else if ( event.data == YT.PlayerState.BUFFERING ) {
		
		}
	}
}

function setVideoDimensions( target, location_type, width_perc ) {
	// setting percentage of screen that the video will take
	var wrapper_width = $(window).width();
	var video_width_n;
	var video_height_n;
	
	switch ( location_type ) {
		case "landing":
			wrapper_width = $(window).width();
			break;
		case "section":
			wrapper_width = $(target.getIframe()).parent("figure").width();
			break;
		case "portfolio":
			wrapper_width = $(window).width();
			break;		
	}
		
	video_width_n = Math.round(wrapper_width*width_perc/100);
	video_height_n = Math.round(video_width_n/1.77);
	target.setSize( video_width_n, video_height_n );
}


$(window).bind("load", function() { 
    var timeout = setTimeout(function() {$("img.lazy").trigger("lazyload")}, 5000);
});