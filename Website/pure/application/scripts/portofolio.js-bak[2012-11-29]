/*	
	By Kafetzi Dimitri (www.kafetzisd.gr)
	This file contains custom scripts required by websites functionality

*/

/*
	Setting up the page
*/
var portfolio_trailers = [];
var portfolio_trailers_ids = [];
var tag = document.createElement('script');
tag.src = "//www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
var $masonry_container = $('#stage');
var masonryOptions = {
        itemSelector: '.portfolio_item.visible',
        animate: true,
        animationOptions: {
			duration: 700,
            queue: true
        },
		containerStyle : {
			position: 'relative'
		},
		gutterWidth : 0,
		isFitWidth : true,
		isResizable : true
    };
var addthis_config = {
	"ui_click": true,
	"ui_language": 'el',
	"data_ga_property": 'UA-35818718-1',
	"data_ga_social": true,
	"data_track_addressbar": false
};
var portfolio_slideshow_video;
var url_hash;

$(document).ready(function(){
	
	url_hash = window.location.hash;
	
	setTopLevelNavBar();
	
	addthis.init(); 
	
	$masonry_container.imagesLoaded(function(){
		$masonry_container.masonry( masonryOptions );
	});
	
	$("nav#filter ul li").bind( "click",
					function( e ) {
						e.preventDefault();
						$(this).addClass("selected");
						$(this).siblings().removeClass("selected");
						$('html, body').animate( {scrollTop:10 }, { duration: 10 ,specialEasing: {height: 'easeOutBounce'}});
						for ( var i = 0; i < portfolio_trailers.length; i++ ) {
							portfolio_trailers[i].stopVideo();
						}
						
						$.each( $(".portfolio_item"),
							function ( ) {
								if ( $(this).hasClass( $(e.currentTarget).attr("id") ) ) {
										$(this).removeClass("invisible");
										$(this).addClass("visible");
										$masonry_container.children('.visible').toggleClass('visible').fadeIn(1000);
									} else {
										$(this).removeClass("visible");
										$(this).addClass("invisible");
										$masonry_container.children('.invisible').toggleClass('invisible').fadeOut(1000);
									}
							
							}
						);
						$masonry_container.masonry( masonryOptions );
					}
			);
	
	$(".portfolio_item_figure").hover(
						function( e ) {
							if ( $(window).width() >= 740 ) {
								e.preventDefault();
								if ( !$(this).hasClass("addthis_loaded") ) {
									setAddThis( 
											$(this).find(".portfolio_item_share_counters").attr( "id" ),
											$(this).find(".portfolio_item_share_social").attr( "id" ),
											addthis_config,
											"http://www.unmanned-evolution.com/application/"+$(this).find(".portfolio_item_media").attr("data-original"), //url
											$(this).find(".portfolio_item_media").attr("title"), //title
											$(this).find(".portfolio_item_caption p").text() //description
									);
									$(this).addClass("addthis_loaded");
								}
														
								$(this).find("header").css( "display", "inline-block" );
								$(this).find("footer").css( "display", "inline-block" );
								$(this).find(".portfolio_item_caption").css( "display", "inline-block" );
							}
						},
						function( e ) {
							if ( $(window).width() >= 740 ) {
								e.preventDefault();
								$(this).find("header").css( "display", "none" );
								$(this).find("footer").css( "display", "none" );
								$(this).find(".portfolio_item_caption").css( "display", "none" );
							}
						}
				);
	
	
		$(".portfolio_item article").bind( "click",
					function( e ) {
						if ( $(window).width() >= 740 ) {
							var url = "http://www.unmanned-evolution.com/";
							var title = "";
							var description = "";
							var append_html;
							
							e.preventDefault();
							
							
							for( var key in portfolio_trailers_ids ) {
								portfolio_trailers[ portfolio_trailers_ids[key] ].pauseVideo();  
							}						
							
							$.each( portfolio_trailers, function(value) { 
								value.pauseVideo();
								console.log(value);
							});
							
							for ( var i = 0; i < portfolio_trailers.length; i++ ) {
								alert( i + " : ");
								//console.log( portfolio_trailers[i].pauseVideo() );
							}
							
							if ( $(this).has("img").length ) {
								$("#portfolio_slideshow_media_figure").children().remove();
								
								url += "application/portfolio.php#" + $(this).find( "img" ).attr( "id" );
								title += $(this).find(".portfolio_item_media").attr("title");
								description += $(this).find(".portfolio_item_caption p").text();
								append_html = '<img src="' + $(this).find( "img" ).attr( "data-original" ) + '" />'
								$("#portfolio_slideshow_media_figure").append( append_html );
								window.location.hash = "#" + $(this).find( "img" ).attr( "id" );
								//
							} else {
								$("#portfolio_slideshow_media_figure").children().remove();
								
								url += "application/portfolio.php#" + $(this).find(".portfolio_item_media").attr( "id" );
								title += $(this).find(".portfolio_item_media").attr("title");
								description += $(this).find(".portfolio_item_caption p").text();
								append_html = portfolio_trailers[ $(this).find(".portfolio_item_media").attr( "id" ).split("_wrapper",1) ].getVideoEmbedCode();
								$("#portfolio_slideshow_media_figure").append( append_html );
								//portfolio_trailers[ $(this).find(".portfolio_item_media").attr( "id" ).split("_wrapper",1) ].setPlaybackQuality("large");
								window.location.hash = "#" + $(this).find(".portfolio_item_media").attr( "id" );
							}
							
							setAddThisSlideShow(
											addthis_config,
											url,
											title,
											description
									);
									
							$("#portfolio_slideshow_wrapper").css( "display", "block" );
							$("#top_level_header_section_wrapper").css( "display", "none" );
							$("#top_level_footer_section_wrapper").css( "display", "none" );
							$("#stage").css( "display", "none" );
							$("#filter").css( "display", "none" );
						}
					}
		);
	
			
		$(".portfolio_item_full").bind( "click",
					function( e ) {
						if ( $(window).width() >= 740 ) {
							$(this).parents( "figure" ).find( "article" ).click();
						}
					}
			);	
			
		$("#portfolio_slideshow_close img").bind( "click",
					function( e ) {
						e.preventDefault();
						
						$("#portfolio_slideshow_wrapper").css( "display", "none" );
						$("#top_level_header_section_wrapper").css( "display", "block" );
						$("#top_level_footer_section_wrapper").css( "display", "block" );
						$("#stage").css( "display", "block" );
						if ( $.browser.msie || $(window).width() < 740 ) {
							$("#filter").css( "display", "none" );
						} else {
							$("#filter").css( "display", "block" );
						}
						
						$("#portfolio_slideshow_media_figure").children().remove();
						window.location.hash = "";
					}
			);
	
	hashControl();
});


function setTopLevelNavBar() {
	// Requried: Navigation bar drop-down
	$("nav ul li").hover(
		function() {
			$(this).addClass("active");
			$(this).find("ul").css("display", "block");
		},
		function() {
			$(this).removeClass("active");
			$(this).find("ul").css("display", "none");
		}
	);
	
	$("nav ul li").click(
		function(){
			$(this).siblings(".selected").find(".selected").removeClass("selected");	
			$(this).siblings(".selected").removeClass("selected");
			$(this).addClass("selected");
		}
	);
	$("nav ul li ul li").click(
		function(){
			$(this).siblings(".selected").removeClass("selected");
			$(this).parent().parent().siblings(".selected").find("ul li.selected").removeClass("selected");	
			$(this).parent().parent().siblings(".selected").removeClass("selected");
			
			$(this).addClass("selected");
			$(this).parent().parent().addClass("selected");
		}
	);
	
	// Requried: Additional styling elements
	$('nav ul li ul li:first-child').prepend('<li class="arrow"></li>');
	$('nav ul li:first-child').addClass('first');
	$('nav ul li:last-child').addClass('last');
	//$('nav ul li ul').parent().append('<span class="dropdown"></span>').addClass('drop');
				
}

function setCookie(c_name, value, exdays) {
	var exdate = new Date();
	exdate.setDate(exdate.getDate() + exdays);
	var c_value = escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;
}
function getCookie(c_name) {
	var i,x,y,ARRcookies=document.cookie.split(";");
	for (i=0;i<ARRcookies.length;i++) {
		x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
		y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
		x=x.replace(/^\s+|\s+$/g,"");
		if (x==c_name) {
			return unescape(y);
		}
	}
}

function validateEmailAddress( item ) {

    var pattern = new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);
    
	var email = $(item).val();
    
	if ( !pattern.test(email) ) {
        $(item).parent().addClass('error');
        return false;
    }
    return true;
}

function onYouTubeIframeAPIReady() {
	setTimeout( function() {createportfolioTrailers();}, 500 );
}

function createportfolioTrailers ( ) {
	
	//Multi Rotor demo scenes
	portfolio_trailers_ids = [ "multi_rotor_demo_scenes",
								"mountains_video",
								"concerts",
								"concerts_live",
								"running_man",
								"industrial_area",
								"tourism_businesses",
								"observation_environment",
								"downhill_dirfy_2011",
								"parkour_2011",
								"presentation_zembili",
							];
	
	portfolio_trailers[ "multi_rotor_demo_scenes" ] = new YT.Player('multi_rotor_demo_scenes', {
		videoId: '_AeVgCd9U0E',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Mountains 
	portfolio_trailers[ "mountains_video" ] = new YT.Player('mountains_video', {
		videoId: 'rT1BICpC1Gg',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Concerts 
	portfolio_trailers[ "concerts" ] = new YT.Player('concerts', {
		videoId: 'AxmMFyiJ8uA',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Concerts -LIVE-
	portfolio_trailers[ "concerts_live" ] = new YT.Player('concerts_live', {
		videoId: 'AD5CfwNcHHM',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Running Man
	portfolio_trailers[ "running_man" ] = new YT.Player('running_man', {
		videoId: '-TIOiY6qpT8',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Ιndustrial Αrea
	portfolio_trailers[ "industrial_area" ] = new YT.Player('industrial_area', {
		videoId: 'sCE-Ci_ZkKw',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Tourism businesses
	portfolio_trailers[ "tourism_businesses" ] = new YT.Player('tourism_businesses', {
		videoId: 'jvBi8bLDCFk',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Observation Environment
	portfolio_trailers[ "observation_environment" ] = new YT.Player('observation_environment', {
		videoId: 'L86CoQdCNaA',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - DownHill 2011, Dirfy
	portfolio_trailers[ "downhill_dirfy_2011" ] = new YT.Player('downhill_dirfy_2011', {
		videoId: 'yMjJarOY-B8',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - Parkour 2011, Athens
	portfolio_trailers[ "parkour_2011" ] = new YT.Player('parkour_2011', {
		videoId: '6SB9jgI6qks',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	//Air / Video Experts - presentation
	portfolio_trailers[ "presentation_zembili" ] = new YT.Player('presentation_zembili', {
		videoId: 'zkF5QFWbBuU',
		playerVars: {
			'iv_load_policy': 3,
			'autoplay': 0,
			'origin': 'www.unmanned-evolution.com',
			'rel': 0,
			'wmode': 'opaque'
		},
		 events: {
			'onReady': onPlayerReady,
			'onStateChange': onportfolioPlayerStateChanged
		 }
	});
	
	/*
	if ( $(window).width() >= 740 ) {
		for ( var i = 0; i < portfolio_trailers.length; i++ ) {
			setVideoDimensions( portfolio_trailers[i], "portfolio", 25 );
		}
	} else {
		for ( var i = 0; i < portfolio_trailers.length; i++ ) {
		}
	}
	*/
}

function onPlayerReady ( event ) {
	event.target.setPlaybackQuality("large");
}

function onportfolioPlayerStateChanged ( event ) {
	
	var wrapper = $(event.target.getIframe()).parent("figure");
	var wrapper_div = $(event.target.getIframe()).parent("figure").parent("div");
	var iframe = event.target.getIframe();
	
	if ( $(window).width() >= 740 ) {
		if ( event.data == YT.PlayerState.PLAYING ) {
			/*
			setVideoDimensions( event.target, "portfolio", 100 );
			
			$(wrapper).css( "width", "100%" );
			$(wrapper).css( "height", "100%" );
			

			$(iframe).css("background-color", "rgba(252,180,31,0.3)");
			$(iframe).css("z-index", "400");
			*/
		} else if ( event.data == YT.PlayerState.ENDED ) {
			/*
			setVideoDimensions( event.target, "portfolio", 25 );
			$(wrapper_div).css("width", "auto");
			$(iframe).css("background-color", "rgba(200,200,200,0.3)");
			$(iframe).css("z-index", "0");
			*/
		} else if ( event.data == YT.PlayerState.PAUSED ) {
		
		} else if ( event.data == YT.PlayerState.BUFFERING ) {
		
		} 
	}
}

function setVideoDimensions( target, location_type, width_perc ) {
	// setting percentage of screen that the video will take
	var wrapper_width = $(window).width();
	var video_width_n;
	var video_height_n;
	
	switch ( location_type ) {
		case "landing":
			wrapper_width = $(window).width();
			break;
		case "section":
			wrapper_width = $(target.getIframe()).parent("figure").width();
			break;
		case "portfolio":
			wrapper_width = $(window).width();
			break;		
	}
		
	video_width_n = Math.round(wrapper_width*width_perc/100);
	video_height_n = Math.round(video_width_n/1.77);
	target.setSize( video_width_n, video_height_n );
}

function setAddThis ( portfolio_item_counters_id, portfolio_item_social_id, addthis_config, url, title, description ) {
	
	var addthis_share = {
		"url": url,
		"title": title,
		"description": description
	};
	
	if ( portfolio_item_counters_id != "" ) {
		var tbx_counters = document.getElementById( portfolio_item_counters_id );
		tbx_counters.innerHTML += '<a class="addthis_button_facebook_like" fb:like:layout="box_count"></a>';
		tbx_counters.innerHTML += '<a class="addthis_button_tweet" tw:via="unmanned_gr" tw:count="vertical"></a>';
		tbx_counters.innerHTML += '<a class="addthis_button_pinterest_pinit" pi:pinit:media="' + url + '" pi:pinit:layout="vertical"></a>';
		tbx_counters.innerHTML += '<a class="addthis_button_linkedin_counter"></a>';
		tbx_counters.innerHTML += '<a class="addthis_button_stumbleupon_badge"></a>';		
		
		addthis.toolbox( "#"+portfolio_item_counters_id, addthis_config, addthis_share );
	}
	
	if ( portfolio_item_social_id != "" ) {
		var tbx_social = document.getElementById( portfolio_item_social_id );
		tbx_social.innerHTML += '<a class="addthis_button_facebook"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_twitter"></a>';	
		tbx_social.innerHTML += '<a class="addthis_button_linkedin"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_pinterest_pinit" pi:pinit:media="' + url + '"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_stumbleupon"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_tumblr"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_digg"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_delicious"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_reddit"></a>';
		tbx_social.innerHTML += '<a class="addthis_button_compact"></a>';
		tbx_social.innerHTML += '<a class="addthis_bubble_style"></a>';

		addthis.toolbox( "#"+portfolio_item_social_id, addthis_config, addthis_share );
	}

}

function setAddThisSlideShow ( addthis_config, url, title, description ) {
	
	var addthis_share = {
		"url": url,
		"title": title,
		"description": description
	};
		
	$( "#portfolio_slideshow_social a").each( function(){ $(this).remove() } );
	var tbx = document.getElementById( "portfolio_slideshow_social" );
	tbx.innerHTML += '<a class="addthis_button_facebook_like" fb:like:layout="box_count"></a>';
	tbx.innerHTML += '<a class="addthis_button_facebook_send"></a>';
	tbx.innerHTML += '<a class="addthis_button_tweet" tw:via="unmanned_gr" tw:count="vertical"></a>';
	tbx.innerHTML += '<a class="addthis_button_pinterest_pinit" pi:pinit:media="' + url + '" pi:pinit:layout="vertical"></a>';
	tbx.innerHTML += '<a class="addthis_button_linkedin_counter"></a>';
	tbx.innerHTML += '<a class="addthis_button_stumbleupon_badge"></a>';
	tbx.innerHTML += '<a class="addthis_button_tumblr"></a>';
	tbx.innerHTML += '<a class="addthis_button_delicious"></a>';
	tbx.innerHTML += '<a class="addthis_button_digg"></a>';
	tbx.innerHTML += '<a class="addthis_button_compact"></a>';		
	
	addthis.toolbox( "#portfolio_slideshow_social", addthis_config, addthis_share );
	
}

function hashControl( event ) {
	var str = window.location.hash;
	if ( str == "#" || str == "" ) {
		url_hash = "";
		$("#portfolio_slideshow_close img").click();
	} else if ( url_hash != str ) {
		$( str ).parent( "article" ).click();
		url_hash = str;
	}
}


$(window).bind("load", function() { 
    if( $(window).width() >= 740 ) {
		setTimeout(function() {$("img.lazy").trigger("lazyload")}, 10);
	}
});

$(window).bind("resize", function() { 
    $masonry_container.masonry( masonryOptions );
});

$(window).bind("hashchange", function( e ) { 
    e.preventDefault();
	hashControl( e );
});
